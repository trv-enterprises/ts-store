{
	"info": {
		"_postman_id": "ts-store-api-collection",
		"name": "TSStore API",
		"description": "API collection for testing TSStore time series database.\n\nNote: WebSocket endpoint (/ws/write) cannot be tested directly in Postman. Use websocat or similar WebSocket clients.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:21080",
			"type": "string"
		},
		{
			"key": "storeName",
			"value": "test-store",
			"type": "string"
		},
		{
			"key": "apiKey",
			"value": "tsstore_your-api-key-here",
			"type": "string"
		},
		{
			"key": "adminKey",
			"value": "your-admin-key-min-20-chars",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "Health & Info",
			"item": [
				{
					"name": "Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/health",
							"host": ["{{baseUrl}}"],
							"path": ["health"]
						},
						"description": "Check if the server is running"
					}
				}
			]
		},
		{
			"name": "Store Management",
			"item": [
				{
					"name": "Create Store (JSON type)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    pm.collectionVariables.set('storeName', jsonData.name);",
									"    pm.collectionVariables.set('apiKey', jsonData.api_key);",
									"    console.log('Store created. API Key saved to collection variables.');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-Admin-Key",
								"value": "{{adminKey}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"test-store\",\n    \"num_blocks\": 1024,\n    \"data_block_size\": 4096,\n    \"index_block_size\": 4096,\n    \"data_type\": \"json\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/stores",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores"]
						},
						"description": "Create a new JSON store. Returns an API key that must be saved."
					}
				},
				{
					"name": "Create Store (Schema type)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    pm.collectionVariables.set('storeName', jsonData.name);",
									"    pm.collectionVariables.set('apiKey', jsonData.api_key);",
									"    console.log('Schema store created. API Key saved to collection variables.');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-Admin-Key",
								"value": "{{adminKey}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"schema-store\",\n    \"num_blocks\": 1024,\n    \"data_block_size\": 4096,\n    \"index_block_size\": 4096,\n    \"data_type\": \"schema\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/stores",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores"]
						},
						"description": "Create a new schema store for compact JSON storage."
					}
				},
				{
					"name": "List Stores",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/stores",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores"]
						},
						"description": "List all open stores"
					}
				},
				{
					"name": "Get Store Stats",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/stats",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "stats"]
						},
						"description": "Get statistics for a store"
					}
				},
				{
					"name": "Delete Store",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}"]
						},
						"description": "Delete a store and all its data"
					}
				},
				{
					"name": "Reset Store (Soft Reset)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/reset",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "reset"]
						},
						"description": "Soft reset - clears all data but keeps configuration, schema, and API keys. Old data remains on disk until overwritten. This is an O(1) operation."
					}
				}
			]
		},
		{
			"name": "Data Operations",
			"description": "Unified /data endpoint for all data operations. Content-Type must match store type.",
			"item": [
				{
					"name": "Insert Data (JSON store)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"data\": {\n        \"temperature\": 23.5,\n        \"humidity\": 65.2,\n        \"sensor_id\": \"sensor-001\",\n        \"location\": \"building-a\"\n    }\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/data",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "data"]
						},
						"description": "Insert JSON data with auto-generated timestamp"
					}
				},
				{
					"name": "Insert Data (with timestamp)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"timestamp\": {{$timestamp}}000000,\n    \"data\": {\n        \"temperature\": 23.5,\n        \"humidity\": 65.2,\n        \"sensor_id\": \"sensor-001\"\n    }\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/data",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "data"]
						},
						"description": "Insert data with explicit timestamp (nanoseconds)"
					}
				},
				{
					"name": "Get Data by Timestamp",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/data/time/:timestamp",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "data", "time", ":timestamp"],
							"variable": [
								{
									"key": "timestamp",
									"value": "1704067200000000000"
								}
							]
						},
						"description": "Get data by exact timestamp (nanoseconds)"
					}
				},
				{
					"name": "Delete Data by Timestamp",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/data/time/:timestamp",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "data", "time", ":timestamp"],
							"variable": [
								{
									"key": "timestamp",
									"value": "1704067200000000000"
								}
							]
						},
						"description": "Delete data by timestamp"
					}
				},
				{
					"name": "Get Oldest Data",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/data/oldest?limit=10",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "data", "oldest"],
							"query": [
								{
									"key": "limit",
									"value": "10"
								},
								{
									"key": "include_data",
									"value": "true",
									"description": "Include data in response (default: true)",
									"disabled": true
								}
							]
						},
						"description": "Get oldest data entries"
					}
				},
				{
					"name": "Get Newest Data",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/data/newest?limit=10",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "data", "newest"],
							"query": [
								{
									"key": "limit",
									"value": "10"
								},
								{
									"key": "include_data",
									"value": "true",
									"description": "Include data in response (default: true)",
									"disabled": true
								}
							]
						},
						"description": "Get newest data entries"
					}
				},
				{
					"name": "Get Newest Data (since duration)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/data/newest?since=1h&limit=100",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "data", "newest"],
							"query": [
								{
									"key": "since",
									"value": "1h",
									"description": "Duration: 30s, 5m, 2h, 7d, 1w"
								},
								{
									"key": "limit",
									"value": "100"
								},
								{
									"key": "include_data",
									"value": "true",
									"description": "Include data in response (default: true)",
									"disabled": true
								}
							]
						},
						"description": "Get data from the last hour (or other duration)"
					}
				},
				{
					"name": "Get Data Range (by time)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/data/range?start_time=1704067200000000000&end_time=1704153600000000000&limit=100",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "data", "range"],
							"query": [
								{
									"key": "start_time",
									"value": "1704067200000000000"
								},
								{
									"key": "end_time",
									"value": "1704153600000000000"
								},
								{
									"key": "limit",
									"value": "100"
								},
								{
									"key": "include_data",
									"value": "true",
									"description": "Include data in response (default: true)",
									"disabled": true
								}
							]
						},
						"description": "Get data within a time range (nanoseconds)"
					}
				},
				{
					"name": "Get Data Range (since duration)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/data/range?since=24h&limit=100",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "data", "range"],
							"query": [
								{
									"key": "since",
									"value": "24h",
									"description": "Duration: 30s, 5m, 2h, 7d, 1w"
								},
								{
									"key": "limit",
									"value": "100"
								},
								{
									"key": "include_data",
									"value": "true",
									"description": "Include data in response (default: true)",
									"disabled": true
								}
							]
						},
						"description": "Get data from the last 24 hours (or other duration)"
					}
				}
			]
		},
		{
			"name": "Schema Operations",
			"description": "Schema management for schema-type stores",
			"item": [
				{
					"name": "Get Schema",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/schema",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "schema"]
						},
						"description": "Get the current schema for a schema-type store"
					}
				},
				{
					"name": "Set Schema",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"fields\": [\n        {\"index\": 1, \"name\": \"temperature\", \"type\": \"float32\"},\n        {\"index\": 2, \"name\": \"humidity\", \"type\": \"float32\"},\n        {\"index\": 3, \"name\": \"sensor_id\", \"type\": \"string\"},\n        {\"index\": 4, \"name\": \"location\", \"type\": \"string\"}\n    ]\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/schema",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "schema"]
						},
						"description": "Set or update the schema. New schemas must be append-only (can only add fields)."
					}
				},
				{
					"name": "Insert Schema Data (full format)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"data\": {\n        \"temperature\": 23.5,\n        \"humidity\": 65.2,\n        \"sensor_id\": \"sensor-001\",\n        \"location\": \"building-a\"\n    }\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/data",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "data"]
						},
						"description": "Insert data using full field names (auto-compacted for storage)"
					}
				},
				{
					"name": "Get Schema Data (full format)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/data/newest?limit=10&format=full",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "data", "newest"],
							"query": [
								{
									"key": "limit",
									"value": "10"
								},
								{
									"key": "include_data",
									"value": "true",
									"description": "Include data in response (default: true)",
									"disabled": true
								},
								{
									"key": "format",
									"value": "full",
									"description": "full (default) or compact"
								}
							]
						},
						"description": "Get schema data with full field names (expanded from compact storage)"
					}
				},
				{
					"name": "Get Schema Data (compact format)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/data/newest?limit=10&format=compact",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "data", "newest"],
							"query": [
								{
									"key": "limit",
									"value": "10"
								},
								{
									"key": "include_data",
									"value": "true",
									"description": "Include data in response (default: true)",
									"disabled": true
								},
								{
									"key": "format",
									"value": "compact",
									"description": "Returns data with numeric field indices"
								}
							]
						},
						"description": "Get schema data in compact format (numeric indices instead of field names)"
					}
				}
			]
		},
		{
			"name": "WebSocket Connections",
			"description": "Manage outbound WebSocket connections. Note: Inbound WebSocket endpoint (/ws/write) requires a WebSocket client like websocat.",
			"item": [
				{
					"name": "List Connections",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/ws/connections",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "ws", "connections"]
						},
						"description": "List all outbound WebSocket connections for the store"
					}
				},
				{
					"name": "Create Push Connection",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"mode\": \"push\",\n    \"url\": \"ws://localhost:9000\",\n    \"from\": 0,\n    \"format\": \"full\",\n    \"headers\": {\n        \"Authorization\": \"Bearer your-token-here\"\n    }\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/ws/connections",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "ws", "connections"]
						},
						"description": "Create an outbound push connection. ts-store will connect to the remote server and send data.\n\nParameters:\n- mode: \"push\" (send data) or \"pull\" (receive data)\n- url: WebSocket URL to connect to\n- from: Start timestamp (0 = from beginning, for push mode)\n- format: \"full\" or \"compact\" (for schema stores)\n- headers: Custom headers for the connection\n- rules: Optional array of alert rules (see Create Push with Alerts)"
					}
				},
				{
					"name": "Create Push Connection with Alerts",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"mode\": \"push\",\n    \"url\": \"ws://localhost:9000\",\n    \"from\": 0,\n    \"format\": \"full\",\n    \"rules\": [\n        {\n            \"name\": \"high_temp\",\n            \"condition\": \"temperature > 80\",\n            \"webhook\": \"https://alerts.example.com/notify\",\n            \"webhook_headers\": {\n                \"Authorization\": \"Bearer webhook-token\"\n            },\n            \"cooldown\": \"5m\"\n        },\n        {\n            \"name\": \"critical_status\",\n            \"condition\": \"status == \\\"error\\\" OR status == \\\"critical\\\"\",\n            \"cooldown\": \"1m\"\n        }\n    ]\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/ws/connections",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "ws", "connections"]
						},
						"description": "Create a push connection with alert rules.\n\nRules are evaluated against each record. When a condition matches:\n- An alert message is sent over the WebSocket\n- If webhook is configured, an HTTP POST is sent\n\nRule parameters:\n- name: Rule identifier\n- condition: Expression like \"field > 80\" or \"status == \\\"error\\\"\"\n- webhook: Optional URL for HTTP notifications\n- webhook_headers: Optional headers for webhook\n- cooldown: Minimum time between alerts (e.g., \"5m\")\n\nCondition syntax:\n- Comparisons: >, >=, <, <=, ==, !=\n- Logical: AND, OR\n- String values must be quoted"
					}
				},
				{
					"name": "Create Pull Connection",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"mode\": \"pull\",\n    \"url\": \"ws://remote-server:8080/data\",\n    \"format\": \"full\",\n    \"headers\": {}\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/ws/connections",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "ws", "connections"]
						},
						"description": "Create an outbound pull connection. ts-store will connect to the remote server and receive data into the store."
					}
				},
				{
					"name": "Get Connection Status",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/ws/connections/:id",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "ws", "connections", ":id"],
							"variable": [
								{
									"key": "id",
									"value": "abc123",
									"description": "Connection ID from create response"
								}
							]
						},
						"description": "Get detailed status of a specific connection including:\n- status: connecting, connected, disconnected, error\n- last_timestamp: Last processed timestamp\n- messages_sent/messages_received: Message counts\n- errors: Error count\n- last_error: Last error message"
					}
				},
				{
					"name": "Delete Connection",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "X-API-Key",
								"value": "{{apiKey}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/stores/{{storeName}}/ws/connections/:id",
							"host": ["{{baseUrl}}"],
							"path": ["api", "stores", "{{storeName}}", "ws", "connections", ":id"],
							"variable": [
								{
									"key": "id",
									"value": "abc123",
									"description": "Connection ID to delete"
								}
							]
						},
						"description": "Stop and remove an outbound connection"
					}
				}
			]
		}
	]
}
